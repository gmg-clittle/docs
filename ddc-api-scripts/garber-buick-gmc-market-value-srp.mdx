---
title: "Market Value Pricing Integration"
description: "Documentation for the Dealer.com market-based pricing injection and API endpoint used to retrieve MSRP values from HomeNet via Redis caching."
---

# Market-Based Pricing Widget (Used Vehicles)

This tool injects **market-based MSRP values** for used vehicles on the Search Results Page (SRP) using Dealer.com's API and a custom serverless API. It highlights MSRP and savings dynamically beneath each used vehicle listing.

---

## ğŸ” Workflow Overview

1. **Script loads on SRP** â†’ Listens to inventory events from Dealer.com API.
2. **Filters  vehicles** and gathers their VINs.
3. **Calls your custom API** at  with those VINs.
4. **Displays**:
   - MSRP (crossed out)
   - Savings pill (`Save $X,XXX`)

---

## ğŸ§© Script (Client-side Injection)

This script should be injected via Dealer.comâ€™s `page-load-v1` and `vehicle-data-updated-v1` event system.

It performs the following:

- Retrieves all `used` VINs on the SRP
- Sends them to your API
- Maps the response to show:
  - Market Based Price (MSRP)
  - Savings calculated from MSRP - Final Price

> âœ… **View full script in** 

---

## ğŸ“¡ API Endpoint Details

### URL

```
GET https://cors-rosy.vercel.app/api/srp-garber-buick-gmc-market-value
```

### Query Parameters

| Parameter | Required | Description                                   |
| --------- | -------- | --------------------------------------------- |
| `vin`     | âœ… Yes    | Comma-separated VINs to fetch MSRP for        |
| `debug`   | âŒ No     | If true, includes Redis and filtering details |

---

## ğŸ§  Serverless API Logic

This is an Edge Function that does the following:

- Retrieves all `USED` vehicles for the rooftop using HomeNet's `LoadCompressedVehicles`
- Parses `<CompressedVehicles>` XML payload
- Maps the `<F ...>` field definitions into usable JSON
- Caches the result in Upstash Redis for 6 hours under the key:\
  `homenet:used:all`
- Filters by requested VINs and returns the final matching records

> âœ… **View full handler in** 

---

## ğŸ§¾ Notes & Best Practices

- Cache is stored for **6 hours** to reduce load on HomeNet.
- The VIN parameter is **required**.
- Supports `debug=true` to return:
  - Whether Redis was used
  - Filtered VIN count
  - Matching vehicles
- Ensure all vehicle prices are numbers before calculating savings.

---

## ğŸ›  Future Enhancements

- Add fallback if MSRP is not present
- Add additional fields such as:
  - Stock number
  - Dealer name
  - Retail price
- Support multiple rooftops in a single API call

---

## ğŸ”— Related Files

-  â€“ Client-side script to inject MSRP/savings
-  â€“ Serverless function
-  â€“ Upstash Redis instance helper
-  â€“ Edge-compatible CORS utility

---

Need help scaling this to multiple dealer rooftops or brands?\
ğŸ“© [developer-support@example.com](mailto:developer-support@example.com)