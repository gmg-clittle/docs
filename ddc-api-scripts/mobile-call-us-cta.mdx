# GMG Mobile ‚ÄúCall Us‚Äù CTA ‚Äì Technical Documentation  
**Developed by the Garber Digital Marketing Team**  
**Last Edited: December 5, 2025 by Chris Little**  

For questions, feature requests, support, or enhancements, please visit:  
üëâ **https://garberspecials.com/support**

---

## Overview

This script injects a **mobile-only ‚ÄúCall Us‚Äù CTA button** into Dealer.com Vehicle Detail Pages (VDPs).

It is designed to:

- Only appear on **mobile VDPs**
- Only appear when the **dealership is currently open** (based on hours from a DDC widget API)
- Use a **Dynamic Number Insertion (DNI)** phone number if available, otherwise fall back to a **host ‚Üí static phone** mapping
- Respect dealer **time zones** (Eastern vs Central)
- Provide detailed debugging output when `#gmgdigitaldebug` is present in the URL

The script is intended to be loaded via Dealer.com‚Äôs **Web Integration API** and executed in the browser as an immediately‚Äëinvoked async function.

---

## High-Level Flow

1. **Early Exit Checks**
   - Exits if `#gmgdigitalmobilectadisable` is present.
   - Detects debug mode (`#gmgdigitaldebug`).
   - Loads CTA CSS via Web Integration API.
   - Load page data (`detailPage`, `layoutType`, `accountId`).

2. **DDC Website ID & Time Zone Resolution**
   - Uses domain ‚Üí DDC ID mapping.
   - Uses domain ‚Üí time zone mapping:
     - Default: Eastern (`America/New_York`)
     - Sunrise Chevrolet: Central (`America/Chicago`)

3. **Operating Hours Check**
   - Calls DDC POST endpoint to fetch store hours.
   - Prioritizes:
     1. `SALES` hours  
     2. `DEALERSHIP` hours  
     3. Default fallback: **8am‚Äì6pm local time**
   - If closed ‚Üí CTA NOT shown.

4. **Phone Number Resolution**
   - Tries to extract phone from DNI cookie (`ai-dni`).
   - If unavailable ‚Üí use domain-specific fallback phone.
   - If still empty ‚Üí no CTA injected.

5. **CTA Injection**
   - Uses Web Integration API (`API.insert` + `API.append`) to inject CTA.
   - CTA links to `tel:{phoneNumber}`.

---

## Dependencies

### Dealer.com Web Integration API

Required global objects/services:

- `window.DDC.APILoader`
- Methods used:
  - `APILoader.create()`
  - `API.loadCSS()`
  - `API.utils.getPageData()`
  - `API.insert()`
  - `API.append()`

### External Resources

- CTA CSS file:  
  `https://assets.garberauto.com/assets/css/gmg-mobile-call-us.css`

### Browser APIs

- `fetch()` for the POST request
- `Intl.DateTimeFormat()` for timezone-correct timestamps
- `document.cookie` for DNI lookup
- Standard DOM manipulation

---

## CTA Injection Conditions

CTA **only appears** if all conditions are true:

1. Not disabled by URL hash
2. Must be **VDP**
3. Must be **mobile layout**
4. Must be **open** (Sales or Dealership hours)
5. A **phone number** must be resolved

If any fail ‚Üí CTA is not inserted.

---

## Hours Logic

### Hours API Endpoint

```
POST /api/widget/ws-site-text-search/addData/{ddcId}/not-apple-mobile-device/{ddcId}/en_US/ws-site-text-search
```

Body:
```json
{ "timeout": 200 }
```

Headers:
```json
{ 
  "Content-Type": "application/json",
  "Accept": "application/json"
}
```

### Department Selection Order

1. **SALES**  
2. **DEALERSHIP**  
3. **Fallback 8am ‚Äì 6pm local time**

Handles multiple response shapes:

- `{ status, data: { hours:{...} } }`
- `{ hours:{...}, dealerInfo:{...} }`

### Time‚ÄëZone‚ÄëAware Evaluation

- Uses dealership‚Äôs local time via `Intl.DateTimeFormat`  
- Parses open/close strings like `"8:30 am - 8:00 pm"`

---

## Debugging

Add this hash to see detailed logs:

```
#gmgdigitaldebug
```

Disable CTA altogether:

```
#gmgdigitalmobilectadisable
```

---

## Support & Future Enhancements

This script is actively maintained by the **Garber Digital Marketing Team**.  
For:

- Bug reports  
- Feature requests  
- Enhancements  
- Technical guidance  
- Documentation updates  

Visit:

üëâ **https://garberspecials.com/support**

---

## Summary

This script provides a production‚Äëgrade, time‚Äëzone‚Äëaware, DNI‚Äëaware mobile Call Us button that:

- Respects dealership business hours  
- Correctly interprets Sales and Dealership hours  
- Falls back gracefully on malformed/missing data  
- Ensures the CTA only appears when appropriate  
- Integrates cleanly with Dealer.com‚Äôs Web Integration API  

Maintained and updated by  
**Garber Digital Marketing Team**  
_Last Edited: December 5, 2025 ‚Äî Chris Little_
