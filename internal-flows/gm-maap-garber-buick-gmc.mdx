---
title: "GM MAAP Price Calculation & Export Workflow (Garber Buick GMC)"
---

# GM MAAP Price Calculation & Export Workflow (Garber Buick GMC)

_Last Updated: 2026-01-21_

---

## Overview

Garber Buick GMC calculates and distributes the GM **MAAP** (Minimum Allowable Advertised Price) per VIN through an automated pipeline spanning **CDK → HomeNet → Google Sheets (Apps Script) → GarberAuto.com API → SFTP → HomeNet → vAuto**.

The end result is a two-column export (**VIN**, **Custom1**) that HomeNet ingests and passes to **vAuto’s Employee Price** field.

---

## System Flow (High Level)

```text
GM Invoice → CDK → HomeNet → Google Sheets (Apps Script) → GarberAuto.com API (per VIN)
→ Google Sheets (Custom1 Export) → SFTP → HomeNet → vAuto (Employee Price)
```

---

## Step 1 — Office Team Entry in CDK (Acct 237 Value)

**Owner:** Office / Accounting Team\
**System:** CDK

1. Open the **GM Invoice** for the vehicle.
2. Locate the **Acct 237 / 231** value on the invoice.
3. Enter that number into:

> **CDK FIELD 21 (CITY)**

This field is repurposed specifically for MAAP workflows.

---

## Step 2 — CDK → HomeNet Mapping (Field 21 → Original Invoice)

**System:** CDK → HomeNet Inventory Feed

CDK feed mapping sends:

| CDK Field       | Description                     | HomeNet Field        |
| --------------- | ------------------------------- | -------------------- |
| Field 21 (CITY) | GM Invoice Acct 237 / 231 value | **Original Invoice** |

---

## Step 3 — HomeNet Conversion (Original Invoice → Comment1)

**System:** HomeNet Data Conversion Rule

A conversion rule copies:

```text
Original Invoice → Comment1
```

This makes the Acct 237 value available downstream (without altering invoice fields).

> **Important:** The Google Sheets Apps Script expects the Acct 237 value to be present in the feed column configured as `Acct237FieldName` (default: `Comment1` in the script settings).

---

## Step 4 — Google Sheets Apps Script (MAAP Engine)

**Owner:** GMG Digital\
**System:** Google Sheets + Apps Script

The calculation engine is implemented in the Apps Script titled:

**“MAAP Launch Vehicle Price Calculator for Garber Buick GMC”**

### Script Header (Reference)

```js
/**
 * MAAP Launch Vehicle Price Calculator for Garber Buick GMC
 *
 * Creates:
 *  - "MAAP_Settings" sheet (if missing) for configuration (styled)
 *  - "MAAP_Raw_Feed" sheet (raw HomeNet CSV, styled)
 *  - "MAAP_Launch_Pricing" sheet (full results, styled)
 *  - "MAAP_Custom1" sheet (VIN + MAAP Launch Vehicle Price as Custom1; minimal styling)
 *  - "MAAP_Run_History" sheet (per-run summary log, styled)
 *
 * Can be run manually or via time-driven trigger.
 */
```

### Sheets Created / Maintained by the Script

The script creates (if missing) and updates these tabs:

- `MAAP_Settings` (configuration, styled)
- `MAAP_Raw_Feed` (raw HomeNet CSV, styled)
- `MAAP_Launch_Pricing` (full calculation results, styled)
- `MAAP_Custom1` (**VIN + Custom1 MAAP price**, minimal styling; export tab)
- `MAAP_Run_History` (run logging + metrics, styled)

These names are defined as constants in the script:

```js
var SETTINGS_SHEET_NAME = 'MAAP_Settings';
var RAW_SHEET_NAME = 'MAAP_Raw_Feed';
var OUTPUT_SHEET_NAME = 'MAAP_Launch_Pricing';
var HISTORY_SHEET_NAME = 'MAAP_Run_History';
var CUSTOM_SHEET_NAME = 'MAAP_Custom1';
```

### Inventory Feed Source (HomeNet CSV)

The script pulls inventory from:

```js
var DEFAULT_FEED_URL =
  'https://assets.garberauto.com/assets/feeds/homenet/garberbuickgmcoffortpierce-6581-Full.csv';
```

This feed URL is configurable via `MAAP_Settings` → `FeedUrl`.

### Settings Tab: What the Script Uses

`MAAP_Settings` contains:

- Feed URL
- Column names used in the HomeNet CSV (Acct 237 field, holdback field, etc.)
- A list of **MAAP-eligible models** (Make / Year / Model / TrimContains)
- Optional `Custom1FlatBuffer` (flat \$ amount added to MAAP before rounding Custom1)

Defaults (as initialized by the script):

- `Acct237FieldName`: `Comment1`
- `HoldbackFieldName`: `Misc_Price2`
- `BookValueFieldName`: `BookValue`
- `TypeFieldName`: `Type`
- `ModelFieldName`: `Model`
- `Custom1FlatBuffer`: `0`

The script also pre-populates the MAAP model rules in `MAAP_Settings`.

### Script Entry Points

- **Manual UI Menu (Spreadsheet):**
  - `MAAP Tools` → `Run MAAP Calculation` → calls `runMaapCalculation()`
  - `MAAP Tools` → `Initialize / Update Settings Sheet` → calls `initMaapSettingsSheet()`
- **Automation:**
  - `runMaapCalculation()` can be executed by a **time-driven trigger**.

---

## Step 5 — Vehicle Eligibility Filtering

The script processes:

- **New vehicles only** (`Type` must be `New`)
- Vehicles matching the configured **MAAP model rules** (Make / Year / Model / TrimContains)

If no model rules are set, it can process all `New` vehicles, but the intended workflow is to restrict to MAAP-eligible models.

---

## Step 6 — Inputs Used for Calculation

For each eligible VIN, the script pulls:

### From HomeNet CSV feed

- VIN (`VIN`)
- MSRP (`MSRP`)
- Invoice (`Invoice`)
- Book Value (`BookValue`) — used for alert comparisons
- **Acct 237/231 value** (configured via `Acct237FieldName`, default `Comment1`)
- **Holdback** (configured via `HoldbackFieldName`, default `Misc_Price2`)

### From Website API (per VIN)

The script calls GarberAuto.com for each VIN:

```text
https://www.garberauto.com/apis/widget/INVENTORY_LISTING_DEFAULT_AUTO_ALL:inventory-data-bus1/getInventory?search={VIN}
```

It extracts:

- Final price (from pricing / dprice where `isFinalPrice === true`, with fallbacks)
- Incentives (cash incentives available to everyone)
- Loyalty/Conquest incentive (max cash option for eligible GM / non-GM owners & lessees)
- CTP flag (if `optionCodes` includes `RtlStkCTP`)

Function responsible:

- `fetchConsumerOffersForVin_(vin)`

---

## Step 7 — MAAP Formula

The script calculates a **Base Invoice** first:

- If Acct 237/231 value is present and \> 0 → **Base Invoice = Acct 237 value**
- Else → **Base Invoice = HomeNet Invoice**

Then applies MAAP:

### Non-CTP Vehicles

```text
MAAP = (Base Invoice + Holdback) − (Consumer Incentives + Loyalty/Conquest)
```

### CTP Vehicles

CTP vehicles do **not** add holdback in the script logic:

```text
MAAP (CTP) = Base Invoice − (Consumer Incentives + Loyalty/Conquest)
```

---

## Step 8 — Alerts (Quality Control)

The script flags an alert if either is below MAAP:

- **DDC/API Final Price** \< MAAP
- **HomeNet Book Value** \< MAAP

Alerts are visible in `MAAP_Launch_Pricing` under **Below MAAP Alert**, and highlighted via `highlightAlerts_()`.

---

## Step 9 — Custom1 Export Output (MAAP_Custom1)

After MAAP is calculated:

- The script optionally applies a flat buffer:

```text
Buffered MAAP = MAAP + Custom1FlatBuffer
```

- Then rounds to a whole dollar amount:

```text
Custom1 = round(Buffered MAAP)
```

### Export Tab Structure

The `MAAP_Custom1` sheet contains exactly:

| Column | Name    |
| ------ | ------- |
| A      | VIN     |
| B      | Custom1 |

Example:

```text
VIN,Custom1
1GKENKKSXTJ101356,43294
1GKB0SDC7RU108327,39850
```

### Inclusion Rules for Custom1

The script only adds a row to `MAAP_Custom1` when:

- Base Invoice is valid and \> 0
- Holdback is valid and \> 0
- MAAP is a valid number

(CTP vehicles still require holdback \> 0 in the feed, even though holdback is not added to MAAP.)

---

## Step 10 — Post-Update Webhook (Optional Automation)

After updating `MAAP_Custom1`, the script triggers a webhook:

- `sendCustom1Webhook_()` posts `{ "updated": true }` to Make.com

(Errors are swallowed so the MAAP job does not fail due to webhook issues.)

---

## Step 11 — SFTP Export to HomeNet

**System:** SFTP → HomeNet

The `MAAP_Custom1` export is uploaded to HomeNet via SFTP as part of the inventory/pricing ingest process.

HomeNet then ingests the **Custom1** value for each VIN.

---

## Step 12 — HomeNet → vAuto (Employee Price)

**System:** HomeNet → vAuto Import

The MAAP value is mapped:

```text
HomeNet Custom1 → vAuto Employee Price
```

This enables vAuto Vehicle Groups pricing logic and supports MAP/MAAP compliant pricing rules.

---

## Responsibility Matrix

| Phase                             | System                    | Owner        |
| --------------------------------- | ------------------------- | ------------ |
| Enter Acct 237/231 value          | CDK                       | Office Team  |
| Enter Holdback value              | CDK                       | Office Team  |
| Field 21 → Original Invoice       | CDK → HomeNet             | Integrations |
| Original Invoice → Comment1       | HomeNet                   | GMG Digital  |
| Calculate MAAP + generate Custom1 | Google Sheets Apps Script | GMG Digital  |
| Retrieve incentives + CTP status  | GarberAuto.com API        | GMG Digital  |
| Export & upload feed to HomeNet   | Make.com & SFTP           | GMG Digital  |
| Import to vAuto (Employee Price)  | HomeNet → vAuto           | vAuto        |

---

## Glossary

| Term           | Meaning                                                   |
| -------------- | --------------------------------------------------------- |
| MAAP           | Minimum Allowable Advertised Price                        |
| Acct 237 / 231 | GM Invoice accounting value used as base for MAAP         |
| CDK            | Dealer DMS                                                |
| HomeNet        | Inventory syndication platform                            |
| vAuto          | Vehicle pricing/merchandising platform                    |
| CTP            | Courtesy Transportation Program                           |
| Custom1        | HomeNet field used to pass MAAP into vAuto Employee Price |